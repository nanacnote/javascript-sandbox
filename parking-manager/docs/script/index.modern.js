var t;function e(){return e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},e.apply(this,arguments)}!function(t){t[t.COST_BY_MILLISECONDS=.001667]="COST_BY_MILLISECONDS",t.ADMIN_STATE_ONLINE="online",t.ADMIN_STATE_OFFLINE="offline",t.DRIVER_STATE_ACTIVE="active",t.DRIVER_STATE_BANNED="banned",t.SPOT_TYPE_STANDARD="standard",t.SPOT_STATE_OPENED="opened",t.SPOT_STATE_RESERVED="reserved",t.SPOT_STATE_OCCUPIED="occupied",t.LOT_STATE_OPENED="opened",t.LOT_STATE_CLOSED="closed",t.PAYMENT_ANNOTATION_CREDIT="credit",t.PAYMENT_ANNOTATION_DEBIT="debit",t.PAYMENT_ACTIVE="active",t.PAYMENT_PROCESSING="processing",t.PAYMENT_SUCCESSFUL="successful",t.PAYMENT_DECLINED="declined",t.REQUEST_PENDING="pending",t.REQUEST_ACCEPTED="accepted",t.REQUEST_REJECTED="rejected",t.REQUEST_USED="used",t.REQUEST_EXPIRED="expired",t.MESSAGE_STATE_DELIVERED="delivered",t.MESSAGE_STATE_READ="read",t.NOTIFICATION_STATE_DISPATCHED="dispatched",t.NOTIFICATION_STATE_RECEIVED="received",t.ORM_LOTS="LOTS",t.ORM_ADMINS="ADMINS",t.ORM_DRIVERS="DRIVERS",t.ORM_MESSAGES="MESSAGES",t.ORM_REQUESTS="REQUESTS",t.ORM_PAYMENTS="PAYMENTS",t.ORM_NOTIFICATIONS="NOTIFICATIONS",t.DB_FILE_PATH="./public/db/index.json",t.API_ENDPOINT_AUTH="/api/v1/auth?",t.API_ENDPOINT_RECOVER_EMAIL="/api/v1/recover-email?",t.API_ENDPOINT_GET_ALL="/api/v1/get_all?",t.API_ENDPOINT_GET="/api/v1/get?",t.API_ENDPOINT_PUT="/api/v1/put?",t.API_ENDPOINT_POST="/api/v1/post?",t.API_ENDPOINT_DELETE="/api/v1/delete?"}(t||(t={}));const r=new class{constructor(){this.db=void 0,fetch(t.DB_FILE_PATH).then(t=>t.json()).then(t=>{this.db=t}).catch(t=>console.error(t))}backend({body:r,endpoint:n}){return new Promise((i,s)=>{const o=setInterval(()=>{if(this.db){clearInterval(o);let a=[];const{pathname:c,searchParams:u}=new URL("http://localhost:3000"+n),h=u.get("table");for(const[t,e]of u)"table"!=t&&(a=[t,e]);switch(c+"?"){case t.API_ENDPOINT_GET_ALL:i(this.db[h]);break;case t.API_ENDPOINT_GET:i(this.db[h].filter(t=>t[a[0]]===a[1])[0]);break;case t.API_ENDPOINT_POST:this.db[h].push(JSON.parse(r)),i(JSON.parse(r));break;case t.API_ENDPOINT_PUT:let n;this.db[h]=this.db[h].map(t=>t[a[0]]===a[1]?(n=e({},t,JSON.parse(r)),n):t),i(n);break;case t.API_ENDPOINT_DELETE:this.db[h]=this.db[h].filter(t=>t[a[0]]!==a[1]),i("{status: SUCCESSFUL}");break;case t.API_ENDPOINT_AUTH:i(this.db[h].filter(t=>t.password===JSON.parse(r).password&&(t.name===JSON.parse(r).name||t.email===JSON.parse(r).email))[0]);break;case t.API_ENDPOINT_RECOVER_EMAIL:i("{status: SUCCESSFUL}");break;default:s(`Unknown api endpoint ${c}`)}}},500)})}};var n,i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(t){!function(e){var r="object"==typeof i?i:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),n=s(t);function s(t,e){return function(r,n){"function"!=typeof t[r]&&Object.defineProperty(t,r,{configurable:!0,writable:!0,value:n}),e&&e(r,n)}}void 0===r.Reflect?r.Reflect=t:n=s(r.Reflect,n),function(t){var e=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,n=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,o={__proto__:[]}instanceof Array,a=!s&&!o,c={create:s?function(){return C(Object.create(null))}:o?function(){return C({__proto__:null})}:function(){return C({})},has:a?function(t,r){return e.call(t,r)}:function(t,e){return e in t},get:a?function(t,r){return e.call(t,r)?t[r]:void 0}:function(t,e){return t[e]}},u=Object.getPrototypeOf(Function),h="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,f=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],r=function(){function t(t,e,r){this._index=0,this._keys=t,this._values=e,this._selector=r}return t.prototype["@@iterator"]=function(){return this},t.prototype[i]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var r=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var r=this._find(t,!0);return this._values[r]=e,this},e.prototype.delete=function(e){var r=this._find(e,!1);if(r>=0){for(var n=this._keys.length,i=r+1;i<n;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new r(this._keys,this._values,n)},e.prototype.values=function(){return new r(this._keys,this._values,s)},e.prototype.entries=function(){return new r(this._keys,this._values,o)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[i]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function n(t,e){return t}function s(t,e){return e}function o(t,e){return[t,e]}}():Map,E=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new f}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[i]=function(){return this.keys()},t}():Set,p=new(h||"function"!=typeof WeakMap?function(){var t=c.create(),r=n();return function(){function t(){this._key=n()}return t.prototype.has=function(t){var e=i(t,!1);return void 0!==e&&c.has(e,this._key)},t.prototype.get=function(t){var e=i(t,!1);return void 0!==e?c.get(e,this._key):void 0},t.prototype.set=function(t,e){return i(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=i(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=n()},t}();function n(){var e;do{e="@@WeakMap@@"+o()}while(c.has(t,e));return t[e]=!0,e}function i(t,n){if(!e.call(t,r)){if(!n)return;Object.defineProperty(t,r,{value:c.create()})}return t[r]}function s(t,e){for(var r=0;r<e;++r)t[r]=255*Math.random()|0;return t}function o(){var t,e=(t=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):s(new Uint8Array(t),t):s(new Array(t),t));e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var r="",n=0;n<16;++n){var i=e[n];4!==n&&6!==n&&8!==n||(r+="-"),i<16&&(r+="0"),r+=i.toString(16).toLowerCase()}return r}}():WeakMap);function d(t,e,r){var n=p.get(t);if(P(n)){if(!r)return;n=new f,p.set(t,n)}var i=n.get(e);if(P(i)){if(!r)return;i=new f,n.set(e,i)}return i}function _(t,e,r){if(T(t,e,r))return!0;var n=Y(e);return!R(n)&&_(t,n,r)}function T(t,e,r){var n=d(e,r,!1);return!P(n)&&!!n.has(t)}function l(t,e,r){if(T(t,e,r))return y(t,e,r);var n=Y(e);return R(n)?void 0:l(t,n,r)}function y(t,e,r){var n=d(e,r,!1);if(!P(n))return n.get(t)}function O(t,e,r,n){d(r,n,!0).set(t,e)}function v(t,e){var r=A(t,e),n=Y(t);if(null===n)return r;var i=v(n,e);if(i.length<=0)return r;if(r.length<=0)return i;for(var s=new E,o=[],a=0,c=r;a<c.length;a++)s.has(f=c[a])||(s.add(f),o.push(f));for(var u=0,h=i;u<h.length;u++){var f;s.has(f=h[u])||(s.add(f),o.push(f))}return o}function A(t,e){var r=[],n=d(t,e,!1);if(P(n))return r;for(var s=function(t){var e=M(t,i);if(!D(e))throw new TypeError;var r=e.call(t);if(!I(r))throw new TypeError;return r}(n.keys()),o=0;;){var a=b(s);if(!a)return r.length=o,r;var c=a.value;try{r[o]=c}catch(t){try{g(s)}finally{throw t}}o++}}function S(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function P(t){return void 0===t}function R(t){return null===t}function I(t){return"object"==typeof t?null!==t:"function"==typeof t}function N(t){var e=function(t,e){switch(S(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var r=M(t,n);if(void 0!==r){var i=r.call(t,"string");if(I(i))throw new TypeError;return i}return function(t,e){var r,n,i=t.toString;if(D(i)&&!I(n=i.call(t)))return n;if(D(r=t.valueOf)&&!I(n=r.call(t)))return n;throw new TypeError}(t)}(t);return"symbol"==typeof e?e:function(t){return""+t}(e)}function m(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function D(t){return"function"==typeof t}function w(t){return"function"==typeof t}function M(t,e){var r=t[e];if(null!=r){if(!D(r))throw new TypeError;return r}}function b(t){var e=t.next();return!e.done&&e}function g(t){var e=t.return;e&&e.call(t)}function Y(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===u)return e;if(e!==u)return e;var r=t.prototype,n=r&&Object.getPrototypeOf(r);if(null==n||n===Object.prototype)return e;var i=n.constructor;return"function"!=typeof i||i===t?e:i}function C(t){return t.__=void 0,delete t.__,t}t("decorate",function(t,e,r,n){if(P(r)){if(!m(t))throw new TypeError;if(!w(e))throw new TypeError;return function(t,e){for(var r=t.length-1;r>=0;--r){var n=(0,t[r])(e);if(!P(n)&&!R(n)){if(!w(n))throw new TypeError;e=n}}return e}(t,e)}if(!m(t))throw new TypeError;if(!I(e))throw new TypeError;if(!I(n)&&!P(n)&&!R(n))throw new TypeError;return R(n)&&(n=void 0),function(t,e,r,n){for(var i=t.length-1;i>=0;--i){var s=(0,t[i])(e,r,n);if(!P(s)&&!R(s)){if(!I(s))throw new TypeError;n=s}}return n}(t,e,r=N(r),n)}),t("metadata",function(t,e){return function(r,n){if(!I(r))throw new TypeError;if(!P(n)&&!function(t){switch(S(t)){case 3:case 4:return!0;default:return!1}}(n))throw new TypeError;O(t,e,r,n)}}),t("defineMetadata",function(t,e,r,n){if(!I(r))throw new TypeError;return P(n)||(n=N(n)),O(t,e,r,n)}),t("hasMetadata",function(t,e,r){if(!I(e))throw new TypeError;return P(r)||(r=N(r)),_(t,e,r)}),t("hasOwnMetadata",function(t,e,r){if(!I(e))throw new TypeError;return P(r)||(r=N(r)),T(t,e,r)}),t("getMetadata",function(t,e,r){if(!I(e))throw new TypeError;return P(r)||(r=N(r)),l(t,e,r)}),t("getOwnMetadata",function(t,e,r){if(!I(e))throw new TypeError;return P(r)||(r=N(r)),y(t,e,r)}),t("getMetadataKeys",function(t,e){if(!I(t))throw new TypeError;return P(e)||(e=N(e)),v(t,e)}),t("getOwnMetadataKeys",function(t,e){if(!I(t))throw new TypeError;return P(e)||(e=N(e)),A(t,e)}),t("deleteMetadata",function(t,e,r){if(!I(e))throw new TypeError;P(r)||(r=N(r));var n=d(e,r,!1);if(P(n))return!1;if(!n.delete(t))return!1;if(n.size>0)return!0;var i=p.get(e);return i.delete(r),i.size>0||p.delete(e),!0})}(n)}()}(n||(n={}));var s,o,a=(s=function(t,e){function r(t,e,r,n){var i,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,r,o):i(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o}function n(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}Object.defineProperty(e,"__esModule",{value:!0});var i,s="JsonProperties",o="JsonIgnore",a=function(t,e){return Reflect.getMetadata(d,t,e)},c=function(t,e){var r=a(t,e);return null!=r&&null!=r.name?r.name:e},u=function(t){switch(t){case E.STRING_TYPE:case E.NUMBER_TYPE:case E.BOOLEAN_TYPE:case E.DATE_TYPE:case E.STRING_TYPE_LOWERCASE:case E.NUMBER_TYPE_LOWERCASE:case E.BOOLEAN_TYPE_LOWERCASE:case E.DATE_TYPE_LOWERCASE:return!0;default:return!1}},h=function(t){return t.name||function(t){var e=t.toString(),r=e.indexOf("class"),n=e.indexOf("{",r+5);return e.substring(r+5,n).trim()}(t)},f=function(t,e){return Reflect.getMetadata("design:type",t,e)},E={OBJECT_TYPE:"Object",OBJECT_TYPE_LOWERCASE:"object",STRING_TYPE:"String",STRING_TYPE_LOWERCASE:"string",NUMBER_TYPE:"Number",NUMBER_TYPE_LOWERCASE:"number",BOOLEAN_TYPE:"Boolean",BOOLEAN_TYPE_LOWERCASE:"boolean",DATE_TYPE:"Date",DATE_TYPE_LOWERCASE:"date",ARRAY_TYPE:"Array",ARRAY_TYPE_LOWERCASE:"array",FROM_ARRAY:"fromArray"},p=function(t,e){var r=null!=t.getJsonObjectMapperCacheKey?t.getJsonObjectMapperCacheKey():h(t);return e[r]||(e[r]=new t),e[r]},d="JsonProperty";(i=e.AccessType||(e.AccessType={}))[i.READ_ONLY=0]="READ_ONLY",i[i.WRITE_ONLY=1]="WRITE_ONLY",i[i.BOTH=2]="BOTH";var _=function(t){return function(e){var r=new Function("return '"+t+"';");e.getJsonObjectMapperCacheKey=r}},T=function(t,e){this.json=e,this.message=t,this.stack=(new Error).stack},l=function(t,e,r,n,i){try{return t[e]=n[i],[]}catch(r){throw new T("Property '"+e+"' of "+t.constructor.name+" does not match datatype of "+i,n)}},y=function(t,e,r,n,i){try{return t[e]=new Date(n[i]),[]}catch(r){throw new T("Property '"+e+"' of "+t.constructor.name+" does not match datatype of "+i,n)}},O=function(t,e,r,n,i){var s=void 0!==i?n[i]||[]:n,o=s.length,a=[],c=[];if(t[e]=c,o>0)for(var f=0;f<o;f++)if(s[f]){var p=h(r);if(u(p))c.push(P[E.FROM_ARRAY](s[f],p));else{var d=new r;a.push({functionName:E.OBJECT_TYPE,instance:d,json:s[f]}),c.push(d)}}return a},v=function(t,r,n,i,c){var p,d=[];null!=r?(p=new n,t[r]=p):p=t;var _=Object.keys(p);return(_=(_=_.concat((Reflect.getMetadata(s,p)||[]).filter(function(t){return(!p.constructor.prototype.hasOwnProperty(t)||void 0!==Object.getOwnPropertyDescriptor(p.constructor.prototype,t).set)&&_.indexOf(t)<0}))).filter(function(t){return!Reflect.hasMetadata(o,p,t)})).forEach(function(t){var r=a(p,t);if(void 0===r&&(r={name:t,required:!1,access:e.AccessType.BOTH}),e.AccessType.WRITE_ONLY!=r.access){if(r.required&&void 0===i[r.name])throw new T("JSON structure does have have required property '"+r.name+"' as required by '"+h(p)+"["+t+"]",i);var n=null!=r.name?r.name:t;if(null!=i[n])if(null!=r.deserializer)p[t]=S(r.deserializer).deserialize(i[n]);else if(void 0===r.type)p[t]=i[n];else if(function(t,e){return Array===f(t,e)}(p,t))P[E.ARRAY_TYPE](p,t,r.type,i,n).forEach(function(t){d.push(t)});else{var s=null!=r.type?h(r.type):function(t,e){var r=f(t,e);return null!=r?h(r):r}(p,t);u(s)?P[s](p,t,s,i,n):(p[t]=new r.type,d.push({functionName:E.OBJECT_TYPE,type:r.type,instance:p[t],json:i[n]}))}}}),d},A={},S=function(t){return p(t,A)},P={};P[E.OBJECT_TYPE]=v,P[E.ARRAY_TYPE]=O,P[E.DATE_TYPE]=y,P[E.STRING_TYPE]=l,P[E.NUMBER_TYPE]=l,P[E.BOOLEAN_TYPE]=l,P[E.FROM_ARRAY]=function(t,e){return e===E.DATE_TYPE?new Date(t):t},P[E.OBJECT_TYPE_LOWERCASE]=v,P[E.ARRAY_TYPE_LOWERCASE]=O,P[E.DATE_TYPE_LOWERCASE]=y,P[E.STRING_TYPE_LOWERCASE]=l,P[E.NUMBER_TYPE_LOWERCASE]=l,P[E.BOOLEAN_TYPE_LOWERCASE]=l;var R=function(t,e,r){var n={},i=e.instance;return e.visited=!0,i.forEach(function(t){if(void 0!==t)if(u(typeof t))e.values.push(U[typeof t](void 0,t,C[typeof t]));else{var i={id:k(),type:E.OBJECT_TYPE,instance:t,parentIndex:r,values:[],key:void 0,visited:!1};n[i.id]=i}}),I(n)},I=function(t){var e=[];return Object.keys(t).forEach(function(r){e.push(t[r])}),e},N=function(t,e){m(t),e.values.push(t.values.pop())},m=function(t){var e,r;e=t.type===E.OBJECT_TYPE?(void 0!==(r=t.key)?'"'+r+'":':"")+"{"+t.values.join()+"}":function(t,e){return(void 0!==t?'"'+t+'":':"")+"["+e.join()+"]"}(t.key,t.values),t.values=[],t.values.push(e)},D=function(t,r,n){var i={};r.visited=!0;var h=Object.keys(r.instance);return(h=(h=h.concat((Reflect.getMetadata(s,r.instance)||[]).filter(function(t){return(!r.instance.constructor.prototype.hasOwnProperty(t)||void 0!==Object.getOwnPropertyDescriptor(r.instance.constructor.prototype,t).get)&&h.indexOf(t)<0}))).filter(function(t){return!Reflect.hasMetadata(o,r.instance,t)})).forEach(function(t){var s=r.instance[t];if(null===s)r.values.push('"'+t+'":'+s);else if(void 0!==s){var o=a(r.instance,t);if(void 0!==o&&e.AccessType.READ_ONLY===o.access);else if(void 0!==o&&void 0!==o.serializer){var h=L(o.serializer);r.values.push(U[E.STRING_TYPE](c(r.instance,t),s,h))}else if(s instanceof Array){var f={id:k(),type:E.ARRAY_TYPE,instance:s,parentIndex:n,values:[],key:c(r.instance,t),visited:!1};i[f.id]=f}else u(typeof s)?(h=C[typeof s],r.values.push(U[typeof s](c(r.instance,t),s,h))):(f={id:k(),type:E.OBJECT_TYPE,instance:s,parentIndex:n,values:[],key:c(r.instance,t),visited:!1},i[f.id]=f)}}),I(i)},w=function(t,e,r){var n=r.serialize(e);return void 0!==t?'"'+t+'":'+n:n},M=r([_("DateSerializer"),n("design:paramtypes",[])],function(){this.serialize=function(t){return t.getTime()}}),b=r([_("StringSerializer"),n("design:paramtypes",[])],function(){this.serialize=function(t){return JSON.stringify(t)}}),g=r([_("NumberSerializer"),n("design:paramtypes",[])],function(){this.serialize=function(t){return t}}),Y=r([_("BooleanSerializer"),n("design:paramtypes",[])],function(){this.serialize=function(t){return t}}),C={};C[E.STRING_TYPE]=new b,C[E.NUMBER_TYPE]=new g,C[E.DATE_TYPE]=new M,C[E.BOOLEAN_TYPE]=new Y,C[E.STRING_TYPE_LOWERCASE]=C[E.STRING_TYPE],C[E.NUMBER_TYPE_LOWERCASE]=C[E.NUMBER_TYPE],C[E.DATE_TYPE_LOWERCASE]=C[E.DATE_TYPE],C[E.BOOLEAN_TYPE_LOWERCASE]=C[E.BOOLEAN_TYPE];var L=function(t){return p(t,C)},U=[];U[E.STRING_TYPE]=w,U[E.NUMBER_TYPE]=w,U[E.BOOLEAN_TYPE]=w,U[E.DATE_TYPE]=w,U[E.ARRAY_TYPE]=R,U[E.OBJECT_TYPE]=D,U[E.STRING_TYPE_LOWERCASE]=w,U[E.NUMBER_TYPE_LOWERCASE]=w,U[E.BOOLEAN_TYPE_LOWERCASE]=w,U[E.DATE_TYPE_LOWERCASE]=w,U[E.ARRAY_TYPE_LOWERCASE]=R,U[E.OBJECT_TYPE_LOWERCASE]=D;var k=function(){return Math.random()+"-"+Date.now()};!function(t){t.deserializeArray=function(t,r){var n=new function(){this.instances=void 0};return e(P[E.ARRAY_TYPE](n,"instances",t,r,void 0)),n.instances},t.deserialize=function(t,r){var n=new t;return e([{functionName:E.OBJECT_TYPE,instance:n,json:r}]),n};var e=function(t){var e=[];t.forEach(function(t){e.push(t)});for(var r=e[0];null!=r;)P[r.functionName](r.instance,r.instanceKey,r.type,r.json,r.jsonKey).forEach(function(t){e.push(t)}),r=e.pop()};t.serialize=function(t){var e=[],r={id:void 0,type:!0===Array.isArray(t)?E.ARRAY_TYPE:E.OBJECT_TYPE,instance:t,parentIndex:void 0,values:[],key:void 0,visited:!1};e.push(r);do{var n=e[e.length-1],i=e[e.length>1?n.parentIndex:0];if(n.visited)N(n,i),e.pop();else{var s=U[n.type](i,n,e.length-1);if(s.length>0)for(var o=s.length;--o>=0;)e.push(s[o]);else e.length>1&&N(n,i),e.pop()}}while(e.length>1);return m(r),r.values[0]}}(e.ObjectMapper||(e.ObjectMapper={})),e.JsonProperty=function(t){return function(t){return function(t,e){return Reflect.metadata(t,e)}(d,t)}("string"==typeof t?{name:t,required:!1,access:e.AccessType.BOTH}:t)},e.JsonConverstionError=T,e.CacheKey=_,e.JsonIgnore=function(){return function(t,e){Reflect.defineMetadata(o,!0,t,e)}},e.DateSerializer=M},s(o={exports:{}},o.exports),o.exports);class c{constructor(t){this.mem=void 0,this.ORM=void 0,this.uid=void 0,this.uid=t||Math.random().toString(16).slice(2)}deserializeArray(t){return a.ObjectMapper.deserializeArray(this.constructor,t)}deserialize(t){return a.ObjectMapper.deserialize(this.constructor,t)}serialize(t){return a.ObjectMapper.serialize(t)}parseQuery(t={}){return new URLSearchParams(e({},t))}fetch({body:t,endpoint:e}){return Promise.resolve(r.backend({body:t,endpoint:e}))}}class u extends c{constructor(t){super(t)}recoverEmail(){return this.ORM===t.ORM_DRIVERS?new Promise((e,r)=>{this.fetch({body:this.serialize(this),endpoint:t.API_ENDPOINT_RECOVER_EMAIL+this.parseQuery({table:this.ORM}),method:"POST"}).then(()=>e(!0)).catch(t=>r(t))}):Promise.reject()}auth(){return this.ORM===t.ORM_ADMINS||this.ORM===t.ORM_DRIVERS?new Promise((e,r)=>{this.fetch({body:this.serialize(this),endpoint:t.API_ENDPOINT_AUTH+this.parseQuery({table:this.ORM}),method:"POST"}).then(t=>e(this.deserialize(t))).catch(t=>r(t))}):Promise.reject()}post(){return new Promise((e,r)=>{this.fetch({body:this.serialize(this),endpoint:t.API_ENDPOINT_POST+this.parseQuery({table:this.ORM}),method:"POST"}).then(t=>e(this.deserialize(t))).catch(t=>r(t))})}put(r){return new Promise((n,i)=>{this.fetch({body:this.serialize(this),endpoint:t.API_ENDPOINT_PUT+this.parseQuery(e({},r,{table:this.ORM})),method:"PUT"}).then(t=>n(this.deserialize(t))).catch(t=>i(t))})}get(r){return new Promise((n,i)=>{this.fetch({endpoint:t.API_ENDPOINT_GET+this.parseQuery(e({},r,{table:this.ORM})),method:"GET"}).then(t=>n(this.deserialize(t))).catch(t=>i(t))})}delete(r){return new Promise((n,i)=>{this.fetch({endpoint:t.API_ENDPOINT_DELETE+this.parseQuery(e({},r,{table:this.ORM})),method:"DELETE"}).then(()=>n(!0)).catch(t=>i(t))})}}class h extends u{constructor({name:e,password:r,uid:n}={}){super(n),this.name=void 0,this.password=void 0,this.state=void 0,this.name=e,this.password=r,this.ORM=t.ORM_ADMINS}modify({name:t,password:e,state:r}={}){return this.name=t||this.name,this.state=r||this.state,this.password=e||this.password,this.put({name:this.name})}register(){return this.post()}login(){return new Promise((e,r)=>{this.auth().then(r=>e(r.modify({state:t.ADMIN_STATE_ONLINE}))).catch(t=>r(t))})}logout(){this.state=t.ADMIN_STATE_OFFLINE}}class f extends u{constructor({name:e,email:r,password:n,uid:i}={}){super(i),this.name=void 0,this.email=void 0,this.password=void 0,this.state=void 0,this.name=e,this.email=r,this.password=n,this.state=t.DRIVER_STATE_ACTIVE,this.ORM=t.ORM_DRIVERS}modify({name:t,email:e,password:r,state:n}={}){return this.name=t||this.name,this.email=e||this.email,this.state=n||this.state,this.password=r||this.password,this.put({email:this.email})}register(){return this.post()}login(){return this.auth()}recover(){return this.recoverEmail()}logout(){}}class E extends u{constructor({name:e,coordinate:r,capacity:n,uid:i}={}){super(i),this.name=void 0,this.state=void 0,this.spots=void 0,this.coordinate=void 0,this.name=e,this.coordinate=r,this.state=t.LOT_STATE_OPENED,this.ORM=t.ORM_LOTS,this.spots=this._instSpots({capacity:n})}modify({name:t,coordinate:e,state:r}={}){return this.state=r||this.state,this.name=t||this.name,this.coordinate=e||this.coordinate,this.put({name:this.name})}register(){return this.post()}getCapacity(){return this.spots.length}getSpot({uid:t}){return this.spots.filter(e=>e===t)[0]}openSpot({uid:e}){for(const r of this.spots)if(r===e){r.state=t.SPOT_STATE_OPENED;break}return this.modify()}reserveSpot({uid:e}){for(const r of this.spots)if(r===e){r.state=t.SPOT_STATE_RESERVED;break}return this.modify()}occupySpot({uid:e}){for(const r of this.spots)if(r===e){r.state=t.SPOT_STATE_OCCUPIED;break}return this.modify()}occupyRandomSpot(){for(const e of this.spots)if(e.state===t.SPOT_STATE_OPENED){e.state=t.SPOT_STATE_OCCUPIED;break}return this.modify()}_instSpots({capacity:e}){let r=[];for(let n=0;n<e;n++)r.push({uid:Math.random().toString(16).slice(2),type:t.SPOT_TYPE_STANDARD,state:t.SPOT_STATE_OPENED});return r}}class p extends u{constructor({lotUID:e,paymentUID:r,start:n,end:i,spotType:s,uid:o}={}){super(o),this.start=void 0,this.end=void 0,this.state=void 0,this.spotType=void 0,this.lotUID=void 0,this.paymentUID=void 0,this.lotUID=e,this.paymentUID=r,this.state=t.REQUEST_PENDING,this.spotType=s||t.SPOT_TYPE_STANDARD,this.ORM=t.ORM_REQUESTS,this.start=new Date(n).toString(),this.end=new Date(i).toString()}modify({state:t}={}){return this.state=t||this.state,this.put({uid:this.uid})}send(){return this.post()}cost(){return(new Date(this.end).getTime()-new Date(this.start).getTime())*t.COST_BY_MILLISECONDS}checkIn(){return this.state=t.REQUEST_USED,new Promise((t,e)=>{this.modify().then(e=>{(new E).get({uid:e.lotUID}).then(e=>t(e.occupyRandomSpot()))}).catch(t=>e(t))})}}class d extends u{constructor({driverUID:e,name:r,ccn:n,ccv:i,exp:s,uid:o}={}){super(o),this.driverUID=void 0,this.name=void 0,this.ccn=void 0,this.ccv=void 0,this.exp=void 0,this.state=void 0,this.annotation=void 0,this.driverUID=e,this.name=r,this.ccn=n,this.ccv=i,this.exp=new Date(s).toString(),this.state=t.PAYMENT_ACTIVE,this.ORM=t.ORM_PAYMENTS}modify({name:t,ccn:e,ccv:r,exp:n}={}){return this.name=t||this.name,this.ccn=e||this.ccn,this.ccv=r||this.ccv,this.exp=n||this.exp,this.put({uid:this.uid})}register(){return this.post()}debit(){this.state=t.PAYMENT_PROCESSING,this.annotation=t.PAYMENT_ANNOTATION_DEBIT}credit(){this.state=t.PAYMENT_PROCESSING,this.annotation=t.PAYMENT_ANNOTATION_CREDIT}}class _ extends u{constructor({toUserUID:e,toUserUIDS:r,fromUserUID:n,title:i,content:s,replyToRef:o,uid:a}={}){super(a),this.toUserUID=void 0,this.fromUserUID=void 0,this.replyToRef=void 0,this.title=void 0,this.content=void 0,this.state=void 0,this.mem=r,this.toUserUID=e,this.fromUserUID=n,this.replyToRef=o,this.title=i,this.content=s,this.ORM=t.ORM_MESSAGES,this.state=t.MESSAGE_STATE_DELIVERED}modify({state:t}={}){return this.state=t||this.state,this.put({uid:this.uid})}send(){let t=[];for(let e=0;e<this.mem.length;e++)t.push(new _({toUserUID:this.mem[e],fromUserUID:this.fromUserUID,title:this.title,content:this.content,replyToRef:this.replyToRef}).post());return Promise.all(t)}}const T={[t.ORM_ADMINS]:h,[t.ORM_DRIVERS]:f,[t.ORM_LOTS]:E,[t.ORM_MESSAGES]:_,[t.ORM_NOTIFICATIONS]:class extends u{constructor({toUserUID:e,content:r,uid:n}={}){super(n),this.toUserUID=void 0,this.content=void 0,this.state=void 0,this.toUserUID=e,this.content=r,this.ORM=t.ORM_NOTIFICATIONS}modify({state:t}={}){return this.state=t||this.state,this.put({uid:this.uid})}send(){return this.state=t.NOTIFICATION_STATE_DISPATCHED,this.post()}},[t.ORM_REQUESTS]:p,[t.ORM_PAYMENTS]:d};class l extends c{constructor(t){super(),this.ORM=t,this.constructor=T[t]}then(e){return new Promise((r,n)=>{this.fetch({endpoint:t.API_ENDPOINT_GET_ALL+this.parseQuery({table:this.ORM}),method:"GET"}).then(t=>this.deserializeArray(t)).then(t=>r(e(t))).catch(t=>n(t))})}}export{h as Admin,l as Collection,f as Driver,E as Lot,_ as Message,d as Payment,p as Request};
//# sourceMappingURL=index.modern.js.map
